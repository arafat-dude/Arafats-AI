<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Archive: IWD | Arafat's Oracle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@19.2.4",
        "react-dom": "https://esm.sh/react-dom@19.2.4",
        "react-dom/client": "https://esm.sh/react-dom@19.2.4/client",
        "htm": "https://esm.sh/htm@3.1.1"
      }
    }
    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { 
                      brown: '#4a3728', 
                      vellum: '#fdfcf4', 
                      gold: '#c5a059', 
                      night: '#0f0f0f' 
                    },
                    fontFamily: { 
                      serif: ['Playfair Display', 'serif'], 
                      sans: ['Inter', 'sans-serif'] 
                    }
                }
            }
        }
    </script>
    <style>
        :root { --vh: 1vh; }
        body { 
            background-color: #fdfcf4; 
            overflow: hidden;
            color: #4a3728;
            height: 100vh;
            height: calc(var(--vh, 1vh) * 100);
            width: 100vw;
        }

        .chat-container {
            scrollbar-width: none;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        .chat-container::-webkit-scrollbar { display: none; }
        
        /* View Transitions */
        .view-enter {
            animation: viewFadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        @keyframes viewFadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-row {
            opacity: 0;
            transform: translateY(10px);
            animation: chatSlideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        @keyframes chatSlideUp {
            to { opacity: 1; transform: translateY(0); }
        }
        
        .vellum-texture {
            background-image: url("https://www.transparenttextures.com/patterns/natural-paper.png");
        }

        .input-pill {
            background: #ffffff;
            box-shadow: 0 4px 30px rgba(74, 55, 40, 0.08);
            border: 1px solid rgba(74, 55, 40, 0.1);
        }

        .sidebar-active {
            background: rgba(197, 160, 89, 0.1);
            color: #4a3728;
        }

        .thinking-anim span {
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .thinking-anim span:nth-child(2) { animation-delay: 0.2s; }
        .thinking-anim span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Expanding FAB Animation */
        .nav-expand-enter {
            animation: fabSlideUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        @keyframes fabSlideUp {
            from { opacity: 0; transform: translateY(20px) scale(0.8); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* IWD Content Styling */
        .iwd-content h4 {
            font-family: 'Playfair Display', serif;
            font-weight: 900;
            font-style: italic;
            color: #4a3728;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        .iwd-content p {
            font-family: 'Inter', sans-serif;
            color: rgba(74, 55, 40, 0.7);
            line-height: 1.8;
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
        }
        .iwd-quote {
            border-left: 4px solid #c5a059;
            padding-left: 1.5rem;
            margin: 2rem 0;
            font-style: italic;
            font-family: 'Playfair Display', serif;
            color: #4a3728;
        }
    </style>
</head>
<body class="font-sans antialiased">
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import htm from 'htm';

        const html = htm.bind(React.createElement);

        const SYSTEM_PROMPT = "You are the Carmelite Oracle, a scholarly and highly intelligent AI. You are a deep expert and advocate for International Women's Day (IWD). Your wisdom is profound but concise; avoid verbosity and deliver brief, impactful responses that get straight to the essence of the query. Maintain a dignified, archival tone in all your interactions.";

        const VAULT_DATA = [
            { name: "Walter White", bio: "You say his name. Heisenberg" },
            { name: "Ada Lovelace", bio: "The world's first programmer, whose early vision paved the way for modern algorithmic logic and the birth of computational archives." },
            { name: "Marie Curie", bio: "A titan of science whose dedication to discovery led to groundbreaking research in radioactivity, earning her two Nobel Prizes." },
            { name: "Maya Angelou", bio: "A voice of profound wisdom and resilience, whose literary contributions continue to inspire generations toward social justice and equality." }
        ];

        const App = () => {
            const [orToken, setOrToken] = useState(localStorage.getItem('or_token') || '');
            const [speechEnabled, setSpeechEnabled] = useState(localStorage.getItem('speech_enabled') === 'true');
            
            const [activeTab, setActiveTab] = useState('ORACLE');
            const [navExpanded, setNavExpanded] = useState(false);
            const [query, setQuery] = useState('');
            const [chat, setChat] = useState([]);
            const [loading, setLoading] = useState(false);
            const chatEndRef = useRef(null);

            useEffect(() => {
                const fixHeight = () => document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`);
                window.addEventListener('resize', fixHeight);
                fixHeight();
                return () => window.removeEventListener('resize', fixHeight);
            }, []);

            useEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [chat, loading]);

            const speakWisdom = (text) => {
                if (!speechEnabled || !window.speechSynthesis) return;
                
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                const voices = window.speechSynthesis.getVoices();

                const voicePatterns = ['Google UK English Male', 'Google UK English Female', 'Microsoft Libere', 'Premium', 'en-GB'];

                let selectedVoice = null;
                for (const pattern of voicePatterns) {
                    selectedVoice = voices.find(v => v.name.includes(pattern) || v.lang === pattern);
                    if (selectedVoice) break;
                }

                if (selectedVoice) utterance.voice = selectedVoice;
                
                utterance.pitch = 0.95; 
                utterance.rate = 0.92; 
                utterance.volume = 1;

                window.speechSynthesis.speak(utterance);
            };

            const logout = () => {
                localStorage.removeItem('or_token');
                localStorage.removeItem('oracle_provider');
                localStorage.removeItem('hf_token');
                setOrToken('');
            };

            const toggleSpeech = () => {
                const newState = !speechEnabled;
                setSpeechEnabled(newState);
                localStorage.setItem('speech_enabled', newState);
                if (!newState) window.speechSynthesis.cancel();
            };

            const callOracle = async () => {
                if (!query.trim() || loading) return;
                
                if (!orToken || orToken.trim() === "") {
                    setChat(prev => [...prev, 
                        { role: 'user', content: query.trim() },
                        { role: 'assistant', content: "Link interrupted. Provide an OpenRouter API key in 'Core Config' to restore the Oracle's wisdom." }
                    ]);
                    setQuery('');
                    return;
                }

                const userMsg = query.trim();
                setChat(prev => [...prev, { role: 'user', content: userMsg }]);
                setQuery('');
                setLoading(true);

                try {
                    const response = await fetch(
                        "https://openrouter.ai/api/v1/chat/completions",
                        {
                            headers: { 
                                "Authorization": `Bearer ${orToken}`, 
                                "Content-Type": "application/json",
                                "HTTP-Referer": window.location.href,
                                "X-Title": "The Oracle"
                            },
                            method: "POST",
                            body: JSON.stringify({ 
                                model: "meta-llama/llama-3.2-3b-instruct",
                                messages: [
                                    { role: "system", content: SYSTEM_PROMPT },
                                    ...chat.slice(-4),
                                    { role: "user", content: userMsg }
                                ],
                                max_tokens: 300
                            }),
                        }
                    );
                    
                    if (!response.ok) {
                        const err = await response.json();
                        throw new Error(err.error?.message || err.error || "Link Interrupted");
                    }
                    
                    const result = await response.json();
                    const text = result.choices?.[0]?.message?.content || "Silence from the Oracle.";
                    
                    const trimmedText = text.trim();
                    setChat(prev => [...prev, { role: 'assistant', content: trimmedText }]);
                    
                    setTimeout(() => speakWisdom(trimmedText), 300);
                } catch (err) {
                    setChat(prev => [...prev, { role: 'assistant', content: `Oracle Fault: ${err.message}. Verify the connection in Config.` }]);
                } finally {
                    setLoading(false);
                }
            };

            return html`
                <div class="flex h-full w-full overflow-hidden">
                    <!-- Sidebar (Desktop) -->
                    <aside class="hidden lg:flex w-64 bg-white border-r border-brown/5 flex-col p-8 z-50">
                        <div class="flex items-center gap-3 mb-12">
                            <div class="w-10 h-10 bg-brown text-gold rounded-xl flex items-center justify-center font-black italic shadow-sm uppercase">O</div>
                            <div>
                                <h1 class="text-[0.6rem] font-black uppercase tracking-[0.2em] text-brown">The Oracle</h1>
                                <p class="text-[0.5rem] font-bold text-gold uppercase tracking-[0.1em]">Archival Intelligence</p>
                            </div>
                        </div>
                        <nav class="flex-1 space-y-2">
                            ${[
                                { id: 'ORACLE', icon: 'auto_awesome', label: 'Oracle' },
                                { id: 'IWD', icon: 'female', label: 'IWD Archive' },
                                { id: 'RECORDS', icon: 'menu_book', label: 'The Archive' },
                                { id: 'CONFIG', icon: 'tune', label: 'Core Config' }
                            ].map(item => html`
                                <button 
                                    key=${item.id}
                                    onClick=${() => setActiveTab(item.id)}
                                    class=${`w-full flex items-center gap-4 px-4 py-3.5 rounded-xl transition-all ${activeTab === item.id ? 'sidebar-active font-bold' : 'text-brown/30 hover:bg-brown/5'}`}
                                >
                                    <span class="material-icons-round text-xl">${item.icon}</span>
                                    <span class="text-[0.65rem] font-bold uppercase tracking-widest">${item.label}</span>
                                </button>
                            `)}
                        </nav>
                        
                        <div class="mt-auto pt-6 border-t border-brown/5">
                            <button onClick=${toggleSpeech} class=${`w-full mb-4 flex items-center gap-4 px-4 py-3 rounded-xl transition-all ${speechEnabled ? 'text-gold bg-brown/5' : 'text-brown/20'}`}>
                                <span class="material-icons-round text-xl">${speechEnabled ? 'volume_up' : 'volume_off'}</span>
                                <span class="text-[0.6rem] font-bold uppercase tracking-widest">${speechEnabled ? 'Voice Active' : 'Voice Silenced'}</span>
                            </button>
                            <div class="mb-4 px-4 py-2 bg-brown/5 rounded-xl text-center">
                                <p class="text-[0.4rem] font-black text-brown/30 uppercase tracking-widest">Protocol</p>
                                <p class="text-[0.6rem] font-bold text-gold uppercase tracking-tighter">OpenRouter Secure</p>
                            </div>
                            <button onClick=${logout} class="flex items-center gap-4 px-4 py-3.5 text-red-800/30 hover:text-red-800 transition-colors">
                                <span class="material-icons-round text-xl">power_settings_new</span>
                                <span class="text-[0.65rem] font-bold uppercase tracking-widest">Clear Keys</span>
                            </button>
                        </div>
                    </aside>

                    <main class="flex-1 flex flex-col h-full relative bg-vellum vellum-texture">
                        <!-- Mobile Header -->
                        <header class="lg:hidden p-4 bg-white border-b border-brown/5 flex items-center justify-between z-50">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-brown text-gold rounded-lg flex items-center justify-center text-xs font-black italic uppercase">O</div>
                                <span class="text-[0.6rem] font-black uppercase tracking-widest text-brown tracking-tighter">The Oracle</span>
                            </div>
                            <div class="flex items-center gap-4">
                                <button onClick=${toggleSpeech} class=${speechEnabled ? 'text-gold' : 'text-brown/20'}>
                                    <span class="material-icons-round">volume_up</span>
                                </button>
                            </div>
                        </header>

                        <div class="flex-1 flex flex-col h-full overflow-hidden">
                            ${activeTab === 'ORACLE' ? html`
                                <div key="ORACLE" class="flex-1 flex flex-col h-full relative view-enter">
                                    <div class="flex-1 chat-container p-6 lg:p-12 pb-24 lg:pb-32">
                                        <div class="max-w-3xl mx-auto space-y-8">
                                            ${chat.length === 0 && html`
                                                <div class="text-center py-20 lg:py-40">
                                                    <div class="w-16 h-16 bg-brown text-gold rounded-full flex items-center justify-center mb-8 mx-auto shadow-xl">
                                                        <span class="material-icons-round text-4xl">auto_awesome</span>
                                                    </div>
                                                    <h2 class="font-serif text-5xl lg:text-6xl font-black text-brown mb-4 italic tracking-tighter">The Oracle Speaks.</h2>
                                                    <p class="text-brown/40 font-serif italic text-xl max-w-sm mx-auto leading-relaxed text-balance">Brief wisdom for the curious seeker.</p>
                                                </div>
                                            `}
                                            ${chat.map((m, i) => html`
                                                <div key=${i} class="message-row flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}">
                                                    <div class=${`max-w-[85%] lg:max-w-[75%] px-7 py-4.5 rounded-[1.8rem] shadow-sm text-lg ${m.role === 'user' ? 'bg-gold text-white font-medium' : 'bg-white border border-brown/5 font-serif italic text-brown'}`}>
                                                        ${m.content}
                                                    </div>
                                                </div>
                                            `)}
                                            ${loading && html`
                                                <div class="flex items-center gap-3 px-4 text-gold">
                                                    <div class="thinking-anim flex gap-1">
                                                        <span class="w-1.5 h-1.5 bg-gold rounded-full"></span>
                                                        <span class="w-1.5 h-1.5 bg-gold rounded-full"></span>
                                                        <span class="w-1.5 h-1.5 bg-gold rounded-full"></span>
                                                    </div>
                                                    <span class="text-[0.6rem] font-black uppercase tracking-widest opacity-40">Consulting records...</span>
                                                </div>
                                            `}
                                            <div ref=${chatEndRef} class="h-4"></div>
                                        </div>
                                    </div>

                                    <!-- Chat Input Panel -->
                                    <div class="absolute bottom-0 left-0 w-full p-4 lg:p-12 bg-gradient-to-t from-vellum via-vellum to-transparent z-40">
                                        <div class="max-w-3xl mx-auto flex gap-4 items-center">
                                            <div class="input-pill rounded-[2rem] p-1.5 flex-1 flex items-center shadow-xl">
                                                <input 
                                                    class="flex-1 px-4 lg:px-6 py-3 lg:py-4 outline-none font-bold text-base lg:text-lg text-brown bg-transparent placeholder-brown/20"
                                                    placeholder="Query the Oracle..."
                                                    value=${query}
                                                    onChange=${e => setQuery(e.target.value)}
                                                    onKeyDown=${e => e.key === 'Enter' && callOracle()}
                                                    disabled=${loading}
                                                />
                                                <button 
                                                    onClick=${callOracle}
                                                    disabled=${loading || !query.trim()}
                                                    class="w-11 h-11 lg:w-14 lg:h-14 rounded-full bg-brown text-gold flex items-center justify-center shadow-lg hover:scale-105 active:scale-95 transition-all disabled:opacity-20"
                                                >
                                                    <span class="material-icons-round text-xl lg:text-2xl">${loading ? 'hourglass_top' : 'arrow_upward'}</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ` : activeTab === 'IWD' ? html`
                                <div key="IWD" class="flex-1 p-8 lg:p-24 overflow-y-auto pb-24 view-enter">
                                    <div class="max-w-4xl mx-auto iwd-content">
                                        <div class="mb-12 lg:mb-16 text-center lg:text-left">
                                            <h2 class="font-serif text-5xl lg:text-8xl font-black italic text-brown tracking-tighter">IWD <span class="text-gold">Archive</span></h2>
                                            <p class="text-brown/40 font-serif italic text-xl mt-4">A historical ledger of International Women's Day.</p>
                                        </div>
                                        
                                        <div class="bg-white p-8 lg:p-16 rounded-[3rem] border border-brown/5 shadow-sm vellum-texture">
                                            <h4>Overview</h4>
                                            <p>International Women's Day (IWD) is a global holiday celebrated annually on March 8 as a focal point in the women's rights movement.</p>
                                            
                                            <div class="iwd-quote">
                                                "Spurred on by the universal female suffrage movement, IWD originated from labor movements in North America and Europe."
                                            </div>

                                            <h4>History</h4>
                                            <p>The earliest reported Women's Day was held on February 28, 1909, in New York City. German delegate Clara Zetkin proposed establishing an annual day at the International Socialist Women's Conference later that year.</p>
                                            
                                            <p>By 1917, following the women's suffrage victory in Soviet Russia, March 8 became a national holiday. The UN adopted the day in 1975.</p>

                                            <h4>Themes</h4>
                                            <p>Since 1996, the UN has adopted annual themes. Themes have evolved from peace and human rights to contemporary calls for accelerated progress and investment in women.</p>
                                            
                                            <div class="mt-12 pt-8 border-t border-brown/5 text-center">
                                                <a href="https://en.wikipedia.org/wiki/International_Women%27s_Day" target="_blank" class="inline-flex items-center gap-2 text-gold font-black uppercase text-[0.6rem] tracking-[0.3em] hover:text-brown transition-colors">
                                                    <span class="material-icons-round">open_in_new</span>
                                                    Full Ledger Reference
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ` : activeTab === 'RECORDS' ? html`
                                <div key="RECORDS" class="flex-1 p-8 lg:p-24 overflow-y-auto pb-24 view-enter">
                                    <div class="max-w-4xl mx-auto">
                                        <div class="mb-12 lg:mb-16">
                                            <h2 class="font-serif text-5xl lg:text-9xl font-black italic text-brown tracking-tighter">The <br/><span class="text-gold">Archive</span></h2>
                                            <p class="text-brown/40 font-serif italic text-xl mt-4">Historical records of distinguished figures.</p>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 lg:gap-8">
                                            ${VAULT_DATA.map((h, i) => html`
                                                <div key=${i} class="bg-white p-8 lg:p-12 rounded-[2.5rem] border border-brown/5 shadow-sm vellum-texture group relative overflow-hidden transition-all hover:border-gold/20">
                                                    <div class="flex items-center gap-3 mb-6 lg:mb-8">
                                                        <div class="h-[1px] w-8 bg-gold/50"></div>
                                                        <span class="text-[0.55rem] font-black text-gold uppercase tracking-[0.4em]">Record #${i+1}</span>
                                                    </div>
                                                    <h3 class="font-serif text-3xl lg:text-4xl font-black text-brown mb-4 lg:mb-6 italic group-hover:text-gold transition-colors">${h.name}</h3>
                                                    <p class="text-brown/60 font-serif text-lg lg:text-xl italic leading-relaxed">${h.bio}</p>
                                                    ${h.name === 'Walter White' && html`<div class="mt-6 inline-flex items-center gap-2 px-3 py-1 bg-gold/10 text-gold rounded-full text-[0.5rem] font-black uppercase tracking-widest">Master of Synthesis</div>`}
                                                </div>
                                            `)}
                                        </div>
                                    </div>
                                </div>
                            ` : html`
                                <div key="CONFIG" class="flex-1 p-8 lg:p-24 overflow-y-auto pb-24 view-enter">
                                    <div class="max-w-2xl mx-auto">
                                        <div class="mb-12 text-center">
                                            <h2 class="font-serif text-5xl lg:text-6xl font-black italic text-brown tracking-tighter">Vault <br/><span class="text-gold">Calibration</span></h2>
                                            <p class="text-brown/40 font-serif italic mt-2">OpenRouter integration for archival access</p>
                                        </div>
                                        <div class="bg-white p-10 lg:p-12 rounded-[2.5rem] border border-brown/5 shadow-sm space-y-10">
                                            <div class="space-y-4">
                                                <label class="text-[0.6rem] font-black uppercase text-brown/40 tracking-widest block ml-2">OpenRouter Access Key</label>
                                                <input 
                                                    type="password"
                                                    value=${orToken}
                                                    onChange=${e => {
                                                        const val = e.target.value;
                                                        setOrToken(val); 
                                                        localStorage.setItem('or_token', val);
                                                        localStorage.setItem('oracle_provider', 'OPENROUTER');
                                                    }}
                                                    placeholder="Enter sk-or-..."
                                                    class="w-full px-6 py-4 rounded-2xl bg-brown/5 border border-brown/10 outline-none focus:border-gold font-mono text-sm"
                                                />
                                            </div>

                                            <button onClick=${logout} class="w-full py-4 border border-red-800/20 text-red-800/40 rounded-2xl text-[0.65rem] font-bold uppercase tracking-widest hover:bg-red-800 hover:text-white transition-all">Reset Core Keys</button>
                                        </div>
                                    </div>
                                </div>
                            `}
                        </div>

                        <!-- Mobile Floating Navigation Hub -->
                        <nav class="lg:hidden fixed bottom-28 right-6 z-[100] flex flex-col items-center gap-3">
                            ${navExpanded && html`
                                <div class="flex flex-col gap-3 mb-2">
                                    ${[
                                        { id: 'ORACLE', icon: 'auto_awesome' },
                                        { id: 'IWD', icon: 'female' },
                                        { id: 'RECORDS', icon: 'menu_book' },
                                        { id: 'CONFIG', icon: 'tune' }
                                    ].filter(item => item.id !== activeTab).map((item, i) => html`
                                        <button 
                                            key=${item.id} 
                                            onClick=${() => { setActiveTab(item.id); setNavExpanded(false); }} 
                                            class="w-12 h-12 rounded-full bg-white border border-brown/10 text-brown shadow-xl flex items-center justify-center transition-all active:scale-90 nav-expand-enter"
                                            style=${{ animationDelay: `${i * 0.05}s` }}
                                        >
                                            <span class="material-icons-round text-xl">${item.icon}</span>
                                        </button>
                                    `)}
                                </div>
                            `}
                            <button 
                                onClick=${() => setNavExpanded(!navExpanded)} 
                                class="w-14 h-14 rounded-full bg-brown text-gold shadow-2xl flex items-center justify-center transition-all active:scale-95"
                            >
                                <span class=${`material-icons-round text-2xl transition-transform duration-300 ${navExpanded ? 'rotate-45' : ''}`}>
                                    ${navExpanded ? 'add' : (
                                        activeTab === 'ORACLE' ? 'auto_awesome' : 
                                        activeTab === 'IWD' ? 'female' : 
                                        activeTab === 'RECORDS' ? 'menu_book' : 'tune'
                                    )}
                                </span>
                            </button>
                        </nav>
                    </main>
                </div>
            `;
        };

        const container = document.getElementById('root');
        const root = createRoot(container);
        root.render(React.createElement(App));
    </script>
</body>
</html>
